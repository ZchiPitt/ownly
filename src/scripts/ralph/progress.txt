# Ralph Progress Log
## Codebase Patterns
- Pattern: Expo lint errors when standard folders exist without lintable files; add minimal `index.ts` placeholders during scaffolding.
- Pattern: For iOS-only Expo stories, Playwright MCP can only verify browser-side prerequisites (server reachability/artifact capture); simulator verification still needs manual execution.
- Pattern: `ActionSheetIOS` is a low-dependency native control for inventory sort/location/category pickers and maps cleanly to TanStack Query keys.
- Pattern: Supabase typed `.maybeSingle()` queries can infer `never` for selected rows in mobile hooks; cast once to a concrete shared type (`Item | null`) before field access.
- Pattern: Reuse a single `ItemEditorForm` for create and edit routes, and keep Supabase mutation wiring in the next story to avoid mixing form UX and persistence concerns.
- Pattern: In this codebase, Supabase typed writes to `items` may infer `never`; keep mutation payload shaping explicit and use narrow casts at the write callsite until shared DB typings are normalized.
Started: Tue Feb 10 02:57:51 PST 2026
---
## 2026-02-10 03:03 - US-001
- What was implemented: Scaffolded the `mobile/` Expo Router iOS app with baseline screens/config, added placeholder index files for core folders, and documented mobile setup commands in `README.md`.
- Files changed: `.gitignore`, `mobile/package.json`, `mobile/app.json`, `mobile/babel.config.js`, `mobile/tsconfig.json`, `mobile/expo-env.d.ts`, `mobile/.eslintrc.cjs`, `mobile/app/_layout.tsx`, `mobile/app/index.tsx`, `mobile/components/index.ts`, `mobile/contexts/index.ts`, `mobile/hooks/index.ts`, `mobile/lib/index.ts`, `mobile/types/index.ts`, `README.md`, `src/scripts/ralph/prd.json`
- **Learnings for future iterations:**
  - Patterns discovered: Expo lint expects lintable files in standard app folders; placeholder `index.ts` files prevent empty-directory lint failures.
  - Gotchas encountered: `expo lint` fails when target directories only contain `.gitkeep`.
  - Useful context: Initial iOS scaffold uses Expo Router with `expo-router` Babel plugin and `main` set to `expo-router/entry`.
---
## 2026-02-10 03:09 - US-002
- What was implemented: Added a typed Supabase client for mobile that reads Expo public env vars with a clear startup error when missing, plus TypeScript env typings.
- Files changed: `mobile/lib/supabase.ts`, `mobile/lib/index.ts`, `mobile/expo-env.d.ts`, `mobile/tsconfig.json`, `mobile/package.json`, `mobile/package-lock.json`, `src/scripts/ralph/prd.json`
- **Learnings for future iterations:**
  - Patterns discovered: None.
  - Gotchas encountered: None.
  - Useful context: Expo public env vars should be read via `process.env.EXPO_PUBLIC_*`.
---
## 2026-02-10 03:12 - US-003
- What was implemented: Added AuthProvider with Supabase auth state handling and secure storage-backed session persistence, plus auth gating/redirects and placeholder auth/home screens.
- Files changed: `mobile/app/_layout.tsx`, `mobile/app/(auth)/login.tsx`, `mobile/app/(tabs)/index.tsx`, `mobile/contexts/AuthProvider.tsx`, `mobile/contexts/index.ts`, `mobile/lib/supabase.ts`, `mobile/package.json`, `mobile/package-lock.json`, `src/scripts/ralph/prd.json`
- **Learnings for future iterations:**
  - Patterns discovered: None.
  - Gotchas encountered: None.
  - Useful context: Auth gate redirects to `(auth)` when session is missing and to `(tabs)` when session exists.
---
## 2026-02-10 05:34 - US-004
- What was implemented: Built login, signup, and reset password screens with validation, loading states, Supabase auth calls, and auth navigation links.
- Files changed: `mobile/app/(auth)/login.tsx`, `mobile/app/(auth)/signup.tsx`, `mobile/app/(auth)/reset.tsx`, `src/scripts/ralph/prd.json`
- **Learnings for future iterations:**
  - Patterns discovered: None.
  - Gotchas encountered: iOS simulator verification not run in this environment; manual verification still required for auth flows.
  - Useful context: Auth gate redirects after session updates; screens only need to call Supabase auth methods.
---
## 2026-02-10 05:39 - US-005
- What was implemented: Added Expo Router tab shell with iOS-style stacks and placeholder detail routes for Inventory, Add, Search, Marketplace, and Settings. Added SafeAreaProvider and shared Screen wrapper for safe-area handling.
- Files changed: `mobile/app/_layout.tsx`, `mobile/app/(tabs)/_layout.tsx`, `mobile/app/(tabs)/index.tsx`, `mobile/app/(tabs)/inventory/_layout.tsx`, `mobile/app/(tabs)/inventory/index.tsx`, `mobile/app/(tabs)/inventory/[id].tsx`, `mobile/app/(tabs)/add/_layout.tsx`, `mobile/app/(tabs)/add/index.tsx`, `mobile/app/(tabs)/add/preview.tsx`, `mobile/app/(tabs)/search/_layout.tsx`, `mobile/app/(tabs)/search/index.tsx`, `mobile/app/(tabs)/search/results.tsx`, `mobile/app/(tabs)/marketplace/_layout.tsx`, `mobile/app/(tabs)/marketplace/index.tsx`, `mobile/app/(tabs)/marketplace/[id].tsx`, `mobile/app/(tabs)/settings/_layout.tsx`, `mobile/app/(tabs)/settings/index.tsx`, `mobile/app/(tabs)/settings/[section].tsx`, `mobile/components/Screen.tsx`, `mobile/components/index.ts`, `src/scripts/ralph/prd.json`
- **Learnings for future iterations:**
  - Patterns discovered: None.
  - Gotchas encountered: Playwright MCP/browser verification is not applicable for iOS-only Expo UI; manual simulator verification still required.
  - Useful context: Stack headers are configured per tab to keep iOS large titles while Tabs handles the bottom bar.
---
## 2026-02-10 05:50 - US-006
- What was implemented: Added inventory infinite pagination using TanStack Query and Supabase with current-user + non-deleted filters, then wired the Inventory tab to real data with loading, empty, error, retry, and list-end load-more states.
- Files changed: `mobile/app/_layout.tsx`, `mobile/app/(tabs)/inventory/index.tsx`, `mobile/hooks/useInventoryItems.ts`, `mobile/hooks/index.ts`, `mobile/lib/queryClient.ts`, `mobile/lib/index.ts`, `mobile/package.json`, `mobile/package-lock.json`, `src/scripts/ralph/prd.json`
- **Learnings for future iterations:**
  - Patterns discovered: Root-level `QueryClientProvider` keeps story-level data hooks minimal and reusable across tabs.
  - Gotchas encountered: Playwright MCP was reachable, but browser verification could not target this iOS-only flow; `playwright.browser_navigate` to `http://127.0.0.1:5173` returned `ERR_CONNECTION_REFUSED`.
  - Useful context: Captured Playwright MCP snapshot output for the failed browser navigation; manual iOS simulator verification is still required for Inventory pagination behavior.
---
## 2026-02-10 05:54 - US-007
- What was implemented: Added inventory sort controls (newest, oldest, name A-Z, name Z-A, expiring, viewed) plus category/location filter controls with iOS-native action sheets, and wired all state into the inventory query so sort/filter changes re-fetch with matching Supabase query clauses.
- Files changed: `mobile/app/(tabs)/inventory/index.tsx`, `mobile/hooks/useInventoryItems.ts`, `src/scripts/ralph/prd.json`
- **Learnings for future iterations:**
  - Patterns discovered: `ActionSheetIOS` works well for single-select filters without adding picker dependencies.
  - Gotchas encountered: Playwright MCP browser verification still cannot reach local dev server in this environment (`http://127.0.0.1:5173` and `http://localhost:5173` both returned `ERR_CONNECTION_REFUSED`) even while Vite reported ready.
  - Useful context: Verification artifacts captured with Playwright MCP snapshot and screenshot (`../../../var/folders/hs/2948r5010wn2c6_35jjmsm6w0000gn/T/playwright-mcp-output/1770731406242/page-2026-02-10T13-53-56-135Z.png`); manual iOS simulator verification remains required for this story.
---
## 2026-02-10 05:57 PST - US-008
- What was implemented: Replaced placeholder inventory detail with a fully data-driven detail experience using Supabase + TanStack Query, including photo display, core item fields, category/location resolution, tags, and metadata sections with null-safe fallback values.
- Files changed: `mobile/app/(tabs)/inventory/[id].tsx`, `mobile/hooks/useInventoryItemDetail.ts`, `mobile/hooks/index.ts`, `src/scripts/ralph/prd.json`
- **Learnings for future iterations:**
  - Patterns discovered: Supabase `.maybeSingle()` item fetches may need an explicit cast to shared `Item` type before field access to avoid `never` inference.
  - Gotchas encountered: Playwright MCP server was healthy but could not connect to local Vite server from MCP browser (`ERR_CONNECTION_REFUSED` for both `http://127.0.0.1:5173` and `http://localhost:5173`), so simulator verification remains manual.
  - Useful context: Captured MCP verification artifacts at `us-008-verification.png` and `us-008-localhost.png`, plus browser snapshots of the connection error state.
---
## 2026-02-10 06:01 PST - US-009
- What was implemented: Added a reusable iOS-native `ItemEditorForm` with validation for required/typed fields, then wired create mode (`/(tabs)/add/manual`) and edit mode (`/(tabs)/inventory/edit/[id]`) screens and navigation entry points from Add and Item Detail.
- Files changed: `mobile/components/ItemEditorForm.tsx`, `mobile/components/index.ts`, `mobile/app/(tabs)/add/manual.tsx`, `mobile/app/(tabs)/add/index.tsx`, `mobile/app/(tabs)/inventory/edit/[id].tsx`, `mobile/app/(tabs)/inventory/[id].tsx`, `src/scripts/ralph/prd.json`
- **Learnings for future iterations:**
  - Patterns discovered: Shared form component keeps create/edit fields and validation logic in one place while allowing story-by-story backend wiring.
  - Gotchas encountered: Playwright MCP verification could run and capture artifacts, but browser navigation to local server still failed with `ERR_CONNECTION_REFUSED`, so simulator verification remains manual.
  - Useful context: Verification artifacts captured at `us-009-verification.png` with MCP snapshot showing `chrome-error://chromewebdata/` unreachable state.
---
## 2026-02-10 06:05 PST - US-010
- What was implemented: Added inventory mutation hooks for create/update/toggle favorite/soft delete with shared value mapping and TanStack Query cache invalidation, then wired manual add and edit submit flows to persist changes and updated item detail with favorite/delete actions.
- Files changed: `mobile/hooks/useInventoryItemMutations.ts`, `mobile/hooks/index.ts`, `mobile/app/(tabs)/add/manual.tsx`, `mobile/app/(tabs)/inventory/edit/[id].tsx`, `mobile/app/(tabs)/inventory/[id].tsx`, `src/scripts/ralph/prd.json`
- **Learnings for future iterations:**
  - Patterns discovered: Centralizing item mutation payload mapping avoids create/edit drift and keeps form value normalization in one place.
  - Gotchas encountered: Playwright MCP server was healthy, but navigation to local dev URL still returned `ERR_CONNECTION_REFUSED`, so browser verification was limited to connection-error artifact capture and iOS simulator verification remains manual.
  - Useful context: Required MCP checks executed (`mcporter list`, `playwright.browser_navigate`, `playwright.browser_snapshot`, `playwright.browser_take_screenshot`) with artifact `us-010-verification.png`.
---
