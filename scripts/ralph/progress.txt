# Ralph Progress Log
# Project: Clekee - Smart Home Inventory App
# Branch: ralph/smart-home-inventory-mvp
# Created: 2026-01-23

## Codebase Patterns
- Uses Tailwind CSS v4 with @tailwindcss/vite plugin (no tailwind.config.js needed)
- Uses TanStack React Query for server state management
- Uses React Router v6 for navigation
- Mobile-first design approach
- Supabase client in `/src/lib/supabase.ts` - import { supabase } from '@/lib/supabase'
- Use `import.meta.env.VITE_*` for environment variables (Vite pattern)
- SQL migrations in `supabase/migrations/` with timestamp prefix (YYYYMMDDHHMMSS_description.sql)
- The `update_updated_at_column()` function exists and is reusable for other tables needing updated_at triggers
- Trigger chain for new users: auth.users -> profiles (via handle_new_user) -> user_settings (via handle_new_profile)

---

## 2026-01-23 - US-001
- What was implemented:
  - Created React app with Vite and TypeScript template
  - Installed and configured Tailwind CSS v4 with @tailwindcss/vite plugin
  - Installed React Router v6 for navigation
  - Installed TanStack React Query for server state management
  - Created base folder structure: /src/components, /src/pages, /src/hooks, /src/lib, /src/types
  - Configured App.tsx with QueryClientProvider and BrowserRouter

- Files changed:
  - package.json (dependencies and project metadata)
  - vite.config.ts (added Tailwind plugin)
  - src/index.css (Tailwind imports and base styles)
  - src/App.tsx (React Query and Router setup)
  - Created folder structure with .gitkeep files

- **Learnings for future iterations:**
  - Tailwind CSS v4 uses `@import "tailwindcss"` syntax, no @tailwind directives
  - Tailwind CSS v4 doesn't need tailwind.config.js when using @tailwindcss/vite plugin
  - The project uses React 19 with concurrent features
  - TanStack React Query v5 is installed
---

## 2026-01-23 - US-002
- What was implemented:
  - Installed @supabase/supabase-js package
  - Created /src/lib/supabase.ts with typed client initialization
  - Created placeholder Database type in /src/types/database.ts (to be expanded in US-011)
  - Created .env.example with VITE_SUPABASE_URL and VITE_SUPABASE_ANON_KEY placeholders
  - Added .env to .gitignore for security

- Files changed:
  - package.json, package-lock.json (added supabase dependency)
  - .gitignore (added .env files)
  - .env.example (new - Supabase config template)
  - src/lib/supabase.ts (new - Supabase client)
  - src/types/database.ts (new - placeholder Database type)

- **Learnings for future iterations:**
  - Supabase client accepts a generic Database type for full TypeScript support
  - Use `import.meta.env.VITE_*` for Vite environment variables
  - Always validate env vars exist at runtime with meaningful error messages
  - The Database type will be expanded in US-011 with full schema
---

## 2026-01-23 - US-003
- What was implemented:
  - Created SQL migration file for profiles table at `supabase/migrations/20260123000001_create_profiles_table.sql`
  - Fields: id (uuid PK), user_id (uuid FK to auth.users, unique), display_name (varchar 50), avatar_url (text nullable), created_at, updated_at
  - Enabled RLS on profiles table
  - Added RLS policies: users can only read/update/insert their own profile
  - Added trigger `on_auth_user_created` to create profile on auth.users insert
  - Added `update_updated_at_column` function and trigger for automatic updated_at maintenance
  - Added documentation comments on table and columns

- Files changed:
  - supabase/migrations/20260123000001_create_profiles_table.sql (new)

- **Learnings for future iterations:**
  - Supabase migrations go in `supabase/migrations/` folder with timestamp prefix
  - Use `SECURITY DEFINER` on trigger functions that need to access auth.users
  - Extract display_name from email with `split_part(email, '@', 1)` as fallback
  - Include INSERT policy for RLS when using triggers that insert data
  - The `update_updated_at_column()` function is reusable for other tables
---

## 2026-01-23 - US-004
- What was implemented:
  - Created SQL migration file for user_settings table at `supabase/migrations/20260123000002_create_user_settings_table.sql`
  - Fields: id (uuid PK), user_id (uuid FK unique), reminder_enabled (bool default true), reminder_threshold_days (int default 90), expiration_reminder_days (int default 7), push_notifications_enabled (bool default false), default_view (varchar 20 default 'gallery'), created_at, updated_at
  - Enabled RLS on user_settings table
  - Added RLS policies: users can only read/update/insert their own settings
  - Added trigger `on_profile_created` to create user_settings when profile is inserted
  - Reused `update_updated_at_column` function from profiles migration for updated_at trigger
  - Added documentation comments on table and columns

- Files changed:
  - supabase/migrations/20260123000002_create_user_settings_table.sql (new)

- **Learnings for future iterations:**
  - The user_settings trigger listens to profiles table insert, not auth.users directly - this ensures proper chain: auth.users -> profiles -> user_settings
  - Reference user_id from NEW.user_id when trigger is on profiles table (not NEW.id)
  - The `update_updated_at_column()` function created in US-003 is shared across all tables
---
